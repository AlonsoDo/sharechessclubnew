<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>ShareChessClub v1.0.0 beta</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="shortcut icon" href="/demos/logo.png">
  <link rel="stylesheet" href="/demos/stylesheet.css">
  <script src="/demos/menu.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-126953307-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());    
    gtag('config', 'UA-126953307-1');
  </script>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="description" content="Share Chess Room using audio, video along with text chat and filesharing with RTCMultiConnection v3.0 lib" />
  <meta name="keywords" content="Chess,Lesson,OnLine,by Internet,Virtual,Web,Video,Chat,Audio,File,Share,Board" />
  
  <link rel="stylesheet" href="res/css/style.css">
  
  <style media="screen" type="text/css">/*<![CDATA[*/@import 'res/css/stylesheet.css';/*]]>*/</style>
  <style media="screen" type="text/css">/*<![CDATA[*/@import 'res/css/demo-files/demo.css';/*]]>*/</style>
      
  <link type="text/css" href="res/css/jquery-ui-1.11.4.custom/jquery-ui.css" rel="stylesheet"/>    
  <link rel="stylesheet" type="text/css" href="res/css/jquery-ui-1.11.icon-font.min.css" />    
  <script src="res/js/jquery-2.2.0.min.js" type="text/javascript"></script>
  <script src="res/css/jquery-ui-1.11.4.custom/jquery-ui.js"></script>
  <script src="res/js/funciones.js" type="text/javascript"></script>
  <script src="res/js/set.js" type="text/javascript"></script>
  <script src="res/js/fabric.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>
  <script src="res/js/stockfish.js"></script>

</head>
<body>  
  
  <!--<header>-->
    <!--<a class="logo" href="/"><img src="/demos/logo.png" alt="RTCMultiConnection"></a>
    <a href="/" class="menu-explorer">Menu<img src="/demos/menu-icon.png" alt="Menu"></a>
    <nav>
      <li>
        <a href="/">Home</a>
      </li>
      <li>
        <a href="/demos/">Demos</a>
      </li>
      <li>
        <a href="https://www.rtcmulticonnection.org/docs/getting-started/">Getting Started</a>
      </li>
      <li>
        <a href="https://www.rtcmulticonnection.org/FAQ/">FAQ</a>
      </li>
      <li>
        <a href="https://www.youtube.com/playlist?list=PLPRQUXAnRydKdyun-vjKPMrySoow2N4tl">YouTube</a>
      </li>
      <li>
        <a href="https://github.com/muaz-khan/RTCMultiConnection/wiki">Wiki</a>
      </li>
      <li>
        <a href="https://github.com/muaz-khan/RTCMultiConnection">Github</a>
      </li>
    </nav>-->
  <!--</header>-->

  <!--<h1>-->
    <!--Audio+Video+TextChat+FileSharing using RTCMultiConnection
    <p class="no-mobile">
      Multi-user (many-to-many) video streaming + text chat + file sharing using mesh networking model.
    </p>-->
  <!--</h1>-->

  <!--<section class="make-center">-->
    <!--<input type="text" id="room-id" value="abcdef" autocorrect=off autocapitalize=off size=20>-->
    <!--<button id="open-room">Open Room</button>-->
    <!--<button id="join-room">Join Room</button>>-->    
    <!--<button id="open-or-join-room">Auto Open Or Join Room</button>-->
    <!--<br><br>-->
    <!--<input type="text" id="input-text-chat" placeholder="Enter Text Chat" disabled>-->
    <!--<button id="share-file" disabled>Share File</button>-->
    <!--<br><br>-->
    <!--<button id="btn-leave-room" disabled>Leave /or close the room</button>-->

    
    <!--<div id="chat-container">-->
        <!--<div id="file-container"></div>>-->
        <!--<div class="chat-output"></div>-->
    <!--</div>-->
    <!--<div id="videos-container"></div>-->
  <!--</section>-->

  <div id="room-urls" style="text-align: center;display: none;background: #F1EDED;margin: 15px -10px;border: 1px solid rgb(189, 189, 189);border-left: 0;border-right: 0;"></div>

  <div id="divconnect" style="background-color:#e8e8e8; border:3px white solid; width:1100px; height:48px; margin:0 auto 0 auto;">
    <label for="name" style="color:green; margin-top:16px; float:left; margin-left:20px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:20px">Room Name:</label>
    <input type="text" id="room-id" value="abcdef" name="idoftheroom" maxlength="50"             
        style="float:left; margin-left:4px; margin-top:6px; width:198px; color:#800080; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:25px"
    >    
    <button style="width:160px; float:left; margin-top:6px; margin-left:14px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" id="open-or-join-room" title="Open the connection and active webcam and sound" type="button"><span style="float:left; font-size:24px; margin-left:10px;" class="ui-icon ui-icon-contact">icon</span>Connect</button>
    <button style="width:180px; float:left; margin-top:6px; margin-left:14px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" id="btn-leave-room" title="Close the connection, deactive webcam and sound" type="button"><span style="float:left; font-size:24px; margin-left:10px;" class="ui-icon ui-icon-link-broken">icon</span>Disconnect</button>
    <label for="name2" style="color:green; float:left; margin-left:14px; margin-top:16px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:20px">Name or Nick:</label>
    <input type="text" id="nick-id" value="" name="idofthenick" maxlength="50" placeholder="Your nick here!"            
        style="float:left; color:#800080; margin-top:6px; margin-left:4px; width:198px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:25px"
    >        
    <button id="playzone" style="width:168px; float:left; margin-top:6px; margin-right:20px; float:right; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Go to kaspichess.com club"><span style="float:left; font-size:24px; margin-left:8px;" class="ui-icon ui-icon-grid">icon</span>KaspiChess</button>
    <label id="cargandoconexion" for="name3" style="color:green; margin-top:16px; float:left; margin-left:20px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:20px">Loading...</label>
    <img id="cargarloader" src="res\img\cargar.gif" style="float:left; margin-top:10px; margin-left:16;">
</div>    

<div id="maindiv" style="border:0px coral solid; width:1106px; height:640px; margin:4px auto 2px auto;">
    <div id="mainleftdiv" style="background-color:#e8e8e8; float:left; border:3px white solid; width:480px; height:632px;">
        <canvas id="BoardCanvas" width="442" height="442" style="margin-top:19px; margin-left:17px; border:3px white solid"></canvas>
        <div id="BtGame" style="margin-top:40px; margin-left:17px; border:3px white solid; width:442px; height:48px;">
            <button id="BtnFlip" style="width:40px; height:35px; margin-left:6px; margin-top:7px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Change the side of the pieces" ><span style="float:left; margin-left:-13px; margin-top:-6px; font-size:24px;" class="ui-icon ui-icon-shuffle">icon</span></button>
            <button id="BtnIni" style="width:40px; height:35px; margin-left:0px; margin-top:7px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Go to the first position"><span style="float:left; margin-left:-13px; margin-top:-6px; font-size:24px;" class="ui-icon ui-icon-arrowstop-1-w">icon</span></button>
            <button id="BtnPrev" style="width:40px; height:35px; margin-left:0px; margin-top:7px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Go to the previous position"><span style="float:left; margin-left:-13px; margin-top:-6px; font-size:24px;" class="ui-icon ui-icon-arrowthick-1-w">icon</span></button>
            <button id="BtnNext" style="width:40px; height:35px; margin-left:0px; margin-top:7px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Go to the next position"><span style="float:left; margin-left:-13px; margin-top:-6px; font-size:24px;" class="ui-icon ui-icon-arrowthick-1-e">icon</span></button>
            <button id="BtnEnd" style="width:40px; height:35px; margin-left:0px; margin-top:7px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Go to the final position"><span style="float:left; margin-left:-13px; margin-top:-6px; font-size:24px;" class="ui-icon ui-icon-arrowstop-1-e">icon</span></button>
            <button id="BtnSave" style="width:90px; height:35px; margin-left:0px; margin-top:7px; padding-top:4px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Save all the moves to a ShareChessClub file format"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-save">icon</span>Save</button>
            <button id="BtnClearAll" style="width:96px; height:35px; margin-left:0px; margin-top:7px; padding-top:4px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Resect all the pieces for a new session"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-power">icon</span>Reset</button>
        </div>
        <div id="BtConfig" style="margin-top:20px; margin-left:17px; border:3px white solid; width:442px; height:48px;">
            <button id="new_Btn" type="button" style="width:90px; height:35px; margin-left:6px; margin-top:7px; padding-top:4px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" title="Load a session file format" class="new_Btn"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-file-table">icon</span>Load</button>
            <input id="BtnLoad" name="file" type='file'" title="Load a session file format"/>                
            <button id="BtnSet" type="button" style="width:82px; height:35px; margin-left:0px; margin-top:7px; padding-top:5px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" title="Set a possition from a extra board"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-puzzle">icon</span>SET</button>
            <button id="BtnFen" type="button" style="width:82px; height:35px; margin-left:0px; margin-top:7px; padding-top:5px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" title="Load a FEN chess character string"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-file-word">icon</span>FEN</button>
            <button id="BtnPGN" type="button" style="width:82px; height:35px; margin-left:0px; margin-top:7px; padding-top:5px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" title="Load the contents of a PGN file"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-file-richtext">icon</span>PGN</button>
        </div>
    </div>
    <div id="maincenterdiv" style="float:left; margin-left:4px; background-color:#e8e8e8; border:3px white solid; width:380px; height:632px;">
        <div id="DivTextChat" style="background-color:#FBEDFF; position:relative; height:240px; width:380px; overflow-x:hidden; overflow-y:scroll;">
    </div>			
    <div id="MensajeChat" style="margin-top:0px; margin-left:0px; border:3px #e8e8e8 solid; width:374px; height:30px;">
    <input type="text" maxlength="200" id="TxtMsg" placeholder="Please type your message here!"           				 
                    style="clear:left; margin-top:5px; font-family:Arial,Helvetica,sans-serif; font-size:14px; margin-left:2px; height:14px; width:280px;">
            <button id="BtnSend" style="width:70px; margin-top:1px; margin-right:0px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Send the message to the chat"><span style="float:left; font-size:18px;" class="ui-icon ui-icon-navigation">icon</span>Send</button>
        </div>
        <div id="DivMoves" style="background-color:#FBEDFF; position:relative; height:310px; width:380px; overflow-x:hidden; overflow-y:scroll;">
    </div>
        <button id="BtnAddText" style="float:right; width:70px; margin-top:13px; margin-right:16px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Put some text to the move"><span style="float:left; font-size:18px;" class="ui-icon ui-icon-comment">icon</span>Text</button>
        <button id="BtnDelete" style="float:right; width:70px; margin-top:13px; margin-right:6px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Delete one inserted move"><span style="float:left; font-size:18px;" class="ui-icon ui-icon-erase">icon</span>Del</button>
        <button id="BtnCutMoves" style="float:right; width:70px; margin-top:13px; margin-right:6px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Cut a large variant of moves"><span style="float:left; font-size:18px;" class="ui-icon ui-icon-cut">icon</span>Cut</button>
        <canvas id="SquareCanvas" width="126" height="38" style="float:left; margin-top:2px; margin-left:4px; border:2px white solid"></canvas>
    </div>
    <div id="videos-container" style="overflow-x:hidden; overflow-y:scroll; float:left; margin-left:4px; background-color:#e8e8e8; border:3px white solid; width:219px; height:632px;">
    </div>
</div>    
<div style=" background-color:#e8e8e8; border:3px white solid; width:1100px; height:280px; margin: 4px auto 0 auto;">        
    <div style="float:left; background-color:#e8e8e8; border:3px white solid; width:1060px; height:50px; margin-left:17px; margin-top:17px;">
        <label style="color:green; float:left; margin-left:25px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Analyzer: Stockfish Engine</label>
        <label style="color:green; float:left; margin-left:25px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Select depth:</label>
        <input id="SetDepth" type="text" name="value" value="5" maxlength="3" style="color:#800080; width:50px; float:left; margin-left:3px; margin-top:8px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:25px">
        <button id="BtnRun" style="float:left; width:86px; height:35px; margin-left:25px; margin-top:8px; padding-top:4px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Run Engine. You must stop the analysis engine to receive new movements."><span style="float:left; font-size:24px;" class="ui-icon ui-icon-circle-triangle-e">icon</span>Run</button>
        <button id="BtnStop" style="float:left; width:86px; height:35px; margin-left:25px; margin-top:8px; padding-top:4px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Stop Engine. You must stop the analysis engine to receive new movements."><span style="float:left; font-size:24px;" class="ui-icon ui-icon-stop">icon</span>Stop</button>
        <label id="StopingLabel" style="color:red; float:left; margin-left:25px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:18px">Stoping...</label>
        <img id="ImgLoader" src="res/img/loader.gif" style="float:left; margin-left:4px; margin-top:8px;">
        <label style="color:red; float:left; margin-left:25px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Best move: </label>
        <div id="Variant0" style="float:left; background-color:#e8e8e8; border:2px white solid; width:110px; height:30px; margin-left:4px; margin-top:9px;">
        </div>
        <label style="color:red; float:left; margin-left:25px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Depth: </label>
        <div style="float:left; background-color:#e8e8e8; border:2px white solid; width:90px; height:30px; margin-left:4px; margin-top:9px;">
            <label id="depthlabel" style="color:green; float:left; margin-left:10px; margin-top:6px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:17px"></label>
        </div>
    </div>
    <div style="float:left; background-color:#e8e8e8; border:3px white solid; width:1060px; height:40px; margin-left:17px; margin-top:17px;">
        <label style="color:red; float:left; margin-left:25px; margin-top:12px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Score:</label>
        <div style="float:left; background-color:#e8e8e8; border:2px white solid; width:70px; height:30px; margin-left:4px; margin-top:3px;">
            <label id="Score1" style="color:green; float:left; margin-left:5px; margin-top:8px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">+10.00</label>
        </div>
        <div id="Variant1" style="float:left; background-color:#e8e8e8; border:2px white solid; width:890px; height:30px; margin-left:4px; margin-top:3px;">
        </div>
    </div>
    <div style="float:left; background-color:#e8e8e8; border:3px white solid; width:1060px; height:40px; margin-left:17px; margin-top:17px;">
        <label style="color:red; float:left; margin-left:25px; margin-top:12px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Score:</label>
        <div style="float:left; background-color:#e8e8e8; border:2px white solid; width:70px; height:30px; margin-left:4px; margin-top:3px;">
            <label id="Score2" style="color:green; float:left; margin-left:5px; margin-top:8px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">+10.00</label>
        </div>
        <div id="Variant2" style="float:left; background-color:#e8e8e8; border:2px white solid; width:890px; height:30px; margin-left:4px; margin-top:3px;">
        </div>
    </div>
    <div style="float:left; background-color:#e8e8e8; border:3px white solid; width:1060px; height:40px; margin-left:17px; margin-top:17px;">
        <label style="color:red; float:left; margin-left:25px; margin-top:12px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Score:</label>
        <div style="float:left; background-color:#e8e8e8; border:2px white solid; width:70px; height:30px; margin-left:4px; margin-top:3px;">
            <label id="Score3" style="color:green; float:left; margin-left:5px; margin-top:8px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">+10.00</label>
        </div>
        <div id="Variant3" style="float:left; background-color:#e8e8e8; border:2px white solid; width:890px; height:30px; margin-left:4px; margin-top:3px;">
        </div>
    </div>
</div>

<div style=" background-color:#e8e8e8; border:3px white solid; width:1100px; height:50px; margin: 4px auto 0 auto;">       
    <button id="share-file" style="float:left; width:132px; height:35px; margin-left:25px; margin-top:8px; padding-top:4px; font-family:Arial,Helvetica,sans-serif; font-weight:bold;" type="button" title="Share files between connections"><span style="float:left; font-size:24px;" class="ui-icon ui-icon-transferthick-e-w">icon</span>Share file</button>
    <label style="color:green; float:left; margin-left:120px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">ShareChessClub version 1.0.0 beta by ApoloSoft (c) 2022 Contact: alonso.caspi@gmail.com</label>
</div>

<div style="background-color:#e8e8e8; border:3px white solid; width:1100px; height:30px; margin: 4px auto 0 auto;">
    <label style="color:green; float:left; margin-left:20px; margin-top:7px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Share File Container</label>
</div>

<div id="file-container" style="width:1100px; height:40px; margin:0 auto 0 auto;">        
</div>

<div style="background-color:#e8e8e8; border:3px white solid; width:1100px; height:350px; margin: 4px auto 0 auto;">
    <img src="res/img/flag-united-kingdom2x.png" style="float:left;">
    <label style="color:green; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Instructions: </label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">1. To share the same space, the code or name of the room must be the same for all participants. You can choose one easier to remember.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">2. Click on the red and green moves to go to the current position.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">3. You need a webcam, microphone and sound.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">4. In case of disconnection it is advisable to reload the page in the browser.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">5. You can do a local test by opening two tabs in the browser and connect to the same room name.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">6. Due to the constant changes while developing the application, it is possible that data from old positions can not be loaded due to incompatibility in the format.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">7. Using a high calculation depth with the analysis engine causes slowness in the web application.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">8. You must stop the analysis engine to receive new movements.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">9. Due to possible problems when making connections it is advisable to use support tools such as Messenger, WhatsApp, Skype, etc ....</label>
</div>

<div style="background-color:#e8e8e8; border:3px white solid; width:1100px; height:420px; margin: 4px auto 0 auto;">
    <img src="res/img/flag-spain2x.png" style="float:left;">
    <label style="color:green; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Instruciones: </label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">1. Para compartir el mismo espacio, el codigo del Room Name debe ser el mismo para todos los participantes. Puedes elegir uno mas facil para recordarlo.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">2. Hacer Click en los movimientos verdes y rojos para ir a la actual posicion.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">3. Se necesita camara web, microfono y sonido para establecer una conexion.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">4. En caso de desconexion es aconsejable recargar la pagina en el navegador.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">5. Se puede hacer un test local abriendo dos pestañas en el navegador utilizando el mismo Room Name.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">6. Debido a los constantes cambios en la aplicacion, es posible que datos de otras sesiones salvadas con el boton Save no sean compatibles entre si en el formato particular de ShareChessClub.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">7. Usar una profundidad grande en el motor de analisis puede causar que la aplicacion se rentilice y que la conexion se corte.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">8. Se debe parar el motor the analisis para recibir nuevos movimientos.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">9. Por posibles problemas haciendo las conexiones es muy recomendable utilizar heramientas externas en modo de ayuda tales como Messenger, WhatsApp, Skype, etc ....</label>
</div>

<div style="background-color:#e8e8e8; border:3px white solid; width:1100px; height:420px; margin: 4px auto 0 auto;">
    <img src="res/img/flag-france2x.png" style="float:left;">
    <label style="color:green; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Instructions: </label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">1. Pour partager le même espace, le code du nom de la salle doit être le même pour tous les participants. Vous pouvez en choisir un plus facile à retenir.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">2. Cliquez sur les mouvements verts et rouges pour aller à la position actuelle.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">3. Vous avez besoin d'une webcam, d'un microphone et d'un son pour établir une connexion.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">4. En cas de déconnexion il est conseillé de recharger la page dans le navigateur.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">5. Un test local peut être effectué en ouvrant deux onglets dans le navigateur en utilisant le même Room Name.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">6. En raison des changements constants dans l'application, les données d'autres sessions enregistrées avec le bouton Enregistrer peuvent ne pas être compatibles entre elles dans le format ShareChessClub particulier.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">7. L'utilisation d'une grande profondeur dans le moteur d'analyse peut entraîner la réutilisation de l'application et la coupure de la connexion.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">8. Le moteur d'analyse doit être arrêté pour recevoir de nouveaux mouvements.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">9. Pour d'éventuels problèmes de connexion, il est fortement recommandé d'utiliser des outils externes en mode d'aide tels que Messenger, WhatsApp, Skype, etc.</label>
</div>

<div style="background-color:#e8e8e8; border:3px white solid; width:1100px; height:420px; margin: 4px auto 0 auto;">
    <img src="res/img/flag-germany2x.png" style="float:left;">
    <label style="color:green; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">Anleitung: </label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">1. Um den gleichen Raum zu teilen, muss der Code für den Room Name für alle Teilnehmer gleich sein. Sie können eine leichtere auswählen, an die Sie sich erinnern können.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">2. Klicken Sie auf die grünen und roten Bewegungen, um zur aktuellen Position zu gelangen.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">3. Sie benötigen eine Webcam, ein Mikrofon und einen Sound, um eine Verbindung herzustellen.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">4. Im Falle einer Trennung ist es ratsam, die Seite im Browser neu zu laden.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">5. Ein lokaler Test kann durchgeführt werden, indem zwei Registerkarten im Browser mit demselben Room Name geöffnet werden.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">6. Aufgrund der ständigen Änderungen in der Anwendung sind Daten aus anderen Sitzungen, die mit der Schaltfläche Speichern gespeichert wurden, möglicherweise nicht mit dem jeweiligen ShareChessClub-Format kompatibel.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">7. Die Verwendung einer großen Tiefe in der Analyse-Engine kann dazu führen, dass die Anwendung erneut verwendet und die Verbindung unterbrochen wird.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">8. Die Analyse-Engine muss angehalten werden, um neue Bewegungen zu erhalten.</label>
    <label style="color:red; float:left; margin-left:20px; margin-top:18px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:15px">9. Bei möglichen Verbindungsproblemen wird dringend empfohlen, im Hilfemodus externe Tools wie Messenger, WhatsApp, Skype usw. zu verwenden.</label>
</div>   

<div id="dialog-promo" title="Promotion">
    <p></p>
    <img id="wqpromo" src="res/img/merida45wq.png"/>
    <img id="wrpromo" src="res/img/merida45wr.png"/>
    <img id="wnpromo" src="res/img/merida45wn.png"/>
    <img id="wbpromo" src="res/img/merida45wb.png"/>
    <img id="bqpromo" src="res/img/merida45bq.png"/>
    <img id="brpromo" src="res/img/merida45br.png"/>
    <img id="bnpromo" src="res/img/merida45bn.png"/>
    <img id="bbpromo" src="res/img/merida45bb.png"/>
    <label style="color:red; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px;">Click on the Piece</label>
</div>

<div id="dialog-info" title="Information">
    <p></p>        
    <label style="color:red; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px;">Attention! This action will delete all the moves of this session. Are you sure?</label>
</div>

<div id="dialog-fen" title="FEN Position">
    <p></p>        
    <input type="text" id="fen-id" value="" name="idofthefen" maxlength="100" placeholder="Type your FEN here!"            
        style="float:left; color:#800080; margin-bottom:30px; margin-top:10px; margin-left:4px; width:400px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px"
    >
    <label style="float:left; color:red; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px;">This action will delete all the moves of this session. Are you sure?</label>
</div>

<div id="dialog-addtext" title="Add text">
    <p></p>        
    <label style="color:red; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px;">Add text after move</label>
    <textarea id="addtxt" style="float:left; color:#800080; margin-bottom:30px; margin-top:10px; margin-left:4px; height:200px; width:380px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px">
    </textarea>
</div>

<div id="dialog-set" title="Set position">            
    <div style="float:left; height:544px; width:564px; margin-top:20px; margin-left:20px; border:0px black solid">
        <canvas id="SetCanvas" width="564" height="544" style="float:left; margin-top:0px; margin-left:0px; border:2px white solid"></canvas>
    </div>        
    <div style="float:left; height:300px; width:180px; margin-top:100px; margin-left:20px; border:3px white solid">  
        <select id="Turno" style="float:left; color:red; margin-left:20px; margin-top:20px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px;">
            <option value="White turn">White turn</option>
            <option value="Black turn">Black turn</option>                
        </select>        
        <label style="float:left; color:red; margin-left:20px; margin-top:20px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:16px;">Castling</label>
        <input type="checkbox" id="EnroqueCortoBlancas" value="ECB" style="float:left; color:green; margin-left:-60px; margin-top:60px;">
        <label style="float:left; color:green; margin-left:-36px; margin-top:58px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:14px;" for="cbox1">White O-O</label>
        <input type="checkbox" id="EnroqueLargoBlancas" value="ECB" style="float:left; color:green; margin-left:-92px; margin-top:80px;">
        <label style="float:left; color:green; margin-left:-69px; margin-top:78px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:14px;" for="cbox1">White O-O-O</label>
        <input type="checkbox" id="EnroqueCortoNegras" value="ECB" style="float:left; color:green; margin-left:-107px; margin-top:100px;">
        <label style="float:left; color:green; margin-left:-84px; margin-top:98px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:14px;" for="cbox1">Black O-O</label>
        <input type="checkbox" id="EnroqueLargoNegras" value="ECB" style="float:left; color:green; margin-left:-107px; margin-top:120px;">
        <label style="float:left; color:green; margin-left:-84px; margin-top:118px; font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:14px;" for="cbox1">Black O-O-O</label>
    </div>
</div>      






<script src="/dist/RTCMultiConnection.min.js"></script>
<script src="/node_modules/webrtc-adapter/out/adapter.js"></script>
<script src="/socket.io/socket.io.js"></script>

<!-- custom layout for HTML5 audio/video elements -->
<link rel="stylesheet" href="/dev/getHTMLMediaElement.css">
<script src="/dev/getHTMLMediaElement.js"></script>

<script src="/node_modules/fbr/FileBufferReader.js"></script>









<script>
window.enableAdapter = true; // enable adapter.js

// ......................................................
// .......................UI Code........................
// ......................................................
/*document.getElementById('open-room').onclick = function() {
    disableInputButtons();
    connection.open(document.getElementById('room-id').value, function() {
        showRoomURL(connection.sessionid);
    });
};

document.getElementById('join-room').onclick = function() {
    disableInputButtons();
    connection.join(document.getElementById('room-id').value);
};*/

document.getElementById('open-or-join-room').onclick = function() {
    //disableInputButtons();
    connection.openOrJoin(document.getElementById('room-id').value, function(isRoomExists, roomid) {
        if (!isRoomExists) {
            showRoomURL(roomid);
        }
    });
    $('#btn-leave-room').show();
    $('#open-or-join-room').hide();
};

document.getElementById('btn-leave-room').onclick = function() {
    
    this.disabled = true;

    //connection.closeBeforeUnload = true;
    //connection.attachStreams.forEach(function(stream) { stream.stop(); });
    
    if (connection.isInitiator) {
        // use this method if you did NOT set "autoCloseEntireSession===true"
        // for more info: https://github.com/muaz-khan/RTCMultiConnection#closeentiresession
        connection.closeEntireSession(function() {
            //document.querySelector('h1').innerHTML = 'Entire session has been closed.';
        });
    }else{
        connection.leave();
    }
    $('#btn-leave-room').hide();
    $('#open-or-join-room').show();
			
    var cNickName = $('#nick-id').val();
     $('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                            cNickName + ': ' + '</span>' + 
                            '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                            'You have leave the room.' + '</span><br>');
    $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);
            /*connection.getSocket().emit('MiEvento',{
                    NickSender: $('#nick-id').val(),
                    CustomMessage: '',
                    Chanel: cChanel,
                    SubEvent: 'Closed'
            });*/                        
    window.location.search = "&roomname=" + $('#room-id').val() + "&nickname=" + $('#nick-id').val();
};

// ......................................................
// ................FileSharing/TextChat Code.............
// ......................................................

document.getElementById('share-file').onclick = function() {
    var fileSelector = new FileSelector();
    fileSelector.selectSingleFile(function(file) {
        connection.send(file);
    });
};

/*document.getElementById('input-text-chat').onkeyup = function(e) {
    if (e.keyCode != 13) return;

    // removing trailing/leading whitespace
    this.value = this.value.replace(/^\s+|\s+$/g, '');
    if (!this.value.length) return;

    connection.send(this.value);
    appendDIV(this.value);
    this.value = '';
};*/

//var chatContainer = document.querySelector('.chat-output');
 
/*function appendDIV(event) {
    var div = document.createElement('div');
    div.innerHTML = event.data || event;
    chatContainer.insertBefore(div, chatContainer.firstChild);
    div.tabIndex = 0;
    div.focus();

    document.getElementById('input-text-chat').focus();
}*/

// ......................................................
// ..................RTCMultiConnection Code.............
// ......................................................

var connection = new RTCMultiConnection();

// by default, socket.io server is assumed to be deployed on your own URL
connection.socketURL = '/';

// comment-out below line if you do not have your own socket.io server
// connection.socketURL = 'https://muazkhan.com:9001/';

connection.socketMessageEvent = 'audio-video-file-chat-demo';

connection.enableFileSharing = true; // by default, it is "false".

connection.session = {
    audio: true,
    video: true,
    data: true
};

connection.sdpConstraints.mandatory = {
    OfferToReceiveAudio: true,
    OfferToReceiveVideo: true
};

// https://www.rtcmulticonnection.org/docs/iceServers/
// use your own TURN-server here!
connection.iceServers = [{
    'urls': [
        /*'stun:stun.l.google.com:19305',
        'stun:stun1.l.google.com:19305',
        'stun:stun2.l.google.com:19305',
        'stun:stun.l.google.com:19305?transport=udp',*/

        'stun.openvoip.it:3478',
        'stun.siplogin.de:3478',
        'stun.tel2.co.uk:3478',
        'stun.gravitel.ru:3478',
        'stun.t-online.de:3478',
        'stun.taxsee.com:3478'

    ]
}];

connection.videosContainer = document.getElementById('videos-container');
 
connection.onstream = function(event) {
    event.mediaElement.removeAttribute('src');
    event.mediaElement.removeAttribute('srcObject');

    var video = document.createElement('video');
    video.controls = true;
    if(event.type === 'local') {
        video.muted = true;
    }
    video.srcObject = event.stream;

    var width = parseInt(connection.videosContainer.clientWidth / 2) - 20;
    var mediaElement = getHTMLMediaElement(video, {
        title: event.userid,
        buttons: ['full-screen'],
        width: width,
        showOnMouseEnter: false
    });

    connection.videosContainer.appendChild(mediaElement);

    setTimeout(function() {
        mediaElement.media.play();
    }, 5000);

    mediaElement.id = event.streamid;
};

/*connection.onstreamended = function(event) {
    var mediaElement = document.getElementById(event.streamid);
    if (mediaElement) {
        mediaElement.parentNode.removeChild(mediaElement);
    }
};*/

//connection.onmessage = appendDIV;
connection.filesContainer = document.getElementById('file-container');

connection.onopen = function() {
    document.getElementById('share-file').disabled = false;
    //document.getElementById('input-text-chat').disabled = false;
    //document.getElementById('btn-leave-room').disabled = false;

    document.querySelector('h1').innerHTML = 'You are connected with: ' + connection.getAllParticipants().join(', ');
};

connection.onclose = function() {
    if (connection.getAllParticipants().length) {
        document.querySelector('h1').innerHTML = 'You are still connected with: ' + connection.getAllParticipants().join(', ');
    } else {
        document.querySelector('h1').innerHTML = 'Seems session has been closed or all participants left.';
    }
};

connection.onEntireSessionClosed = function(event) {
    //document.getElementById('share-file').disabled = true;
    //document.getElementById('input-text-chat').disabled = true;
    //document.getElementById('btn-leave-room').disabled = true;

    //document.getElementById('open-or-join-room').disabled = false;
    //document.getElementById('open-room').disabled = false;
    //document.getElementById('join-room').disabled = false;
    //document.getElementById('room-id').disabled = false;

    connection.attachStreams.forEach(function(stream) {
        stream.stop();
    });

    // don't display alert for moderator
    if (connection.userid === event.userid) return;
    document.querySelector('h1').innerHTML = 'Entire session has been closed by the moderator: ' + event.userid;
};

connection.onUserIdAlreadyTaken = function(useridAlreadyTaken, yourNewUserId) {
    // seems room is already opened
    connection.join(useridAlreadyTaken);
};

function disableInputButtons() {
    //document.getElementById('open-or-join-room').disabled = true;
    //document.getElementById('open-room').disabled = true;
    //document.getElementById('join-room').disabled = true;
    //document.getElementById('room-id').disabled = true;
}

// ......................................................
// ......................Handling Room-ID................
// ......................................................

function showRoomURL(roomid) {
    var roomHashURL = '#' + roomid;
    var roomQueryStringURL = '?roomid=' + roomid;

    var html = '<h2>Unique URL for your room:</h2><br>';

    html += 'Hash URL: <a href="' + roomHashURL + '" target="_blank">' + roomHashURL + '</a>';
    html += '<br>';
    html += 'QueryString URL: <a href="' + roomQueryStringURL + '" target="_blank">' + roomQueryStringURL + '</a>';

    var roomURLsDiv = document.getElementById('room-urls');
    roomURLsDiv.innerHTML = html;

    roomURLsDiv.style.display = 'block';
}

(function() {
    var params = {},
        r = /([^&=]+)=?([^&]*)/g;

    function d(s) {
        return decodeURIComponent(s.replace(/\+/g, ' '));
    }
    var match, search = window.location.search;
    while (match = r.exec(search.substring(1)))
        params[d(match[1])] = d(match[2]);
    window.params = params;
})();

var roomid = '';
if (localStorage.getItem(connection.socketMessageEvent)) {
    roomid = localStorage.getItem(connection.socketMessageEvent);
} else {
    roomid = connection.token();
}
document.getElementById('room-id').value = roomid;
document.getElementById('room-id').onkeyup = function() {
    localStorage.setItem(connection.socketMessageEvent, this.value);
};

var hashString = location.hash.replace('#', '');
if (hashString.length && hashString.indexOf('comment-') == 0) {
    hashString = '';
}

var roomid = params.roomid;
if (!roomid && hashString.length) {
    roomid = hashString;
}

if (roomid && roomid.length) {
    document.getElementById('room-id').value = roomid;
    localStorage.setItem(connection.socketMessageEvent, roomid);

    // auto-join-room
    (function reCheckRoomPresence() {
        connection.checkPresence(roomid, function(isRoomExists) {
            if (isRoomExists) {
                connection.join(roomid);
                return;
            }

            setTimeout(reCheckRoomPresence, 5000);
        });
    })();

    disableInputButtons();
}
</script>

  <footer>
    <small id="send-message"></small>
  </footer>

  <script src="https://www.webrtc-experiment.com/common.js"></script>




  <script>
        
    var cChanel;
    var connection;
    var chess = new Chess();
    var chess2 = new Chess();
    //var stockfish = STOCKFISH();
    var stockfish = new Worker('stockfish.js');
    var AnalizeResult;
    var aAnalizeResult;
    var Analizando = false;
            
    $(document).ready(function(){
        
        stockfish.postMessage("setoption name multipv value 3");
        
        stockfish.onmessage = function(event) {
            
            console.log(event.data ? event.data : event);
            AnalizeResult = event.data ? event.data : event;
            aAnalizeResult = AnalizeResult.split(" ");
            console.log(aAnalizeResult)
            var aSize = aAnalizeResult.length;
            console.log(aSize)
            var Lugar;

            Lugar = BuscarLugar('depth');
            if (Lugar != -1){
                var Profundidad = aAnalizeResult[Lugar+1];
                var ProfundidadTotal = $('#SetDepth').val();
                $('#depthlabel').text(Profundidad + '/' + ProfundidadTotal);
            }

            Lugar = BuscarLugar('bestmove');            
            if (Lugar != -1){
                ConvertVariant(0,aAnalizeResult[Lugar+1]);
                $('#StopingLabel').hide();    
                $('#BtnStop').hide();            
                $('#BtnRun').show();
                $('#ImgLoader').hide();
                Analizando = false;
            }
            
            Lugar = BuscarLugar('multipv')
            if (Lugar != -1){
                if (aAnalizeResult[Lugar+1]==1){
                    console.log('Variante: 1')
                    Lugar = BuscarLugar('cp');
                    if (Lugar != -1){
                        if (aAnalizeResult[Lugar+1] > 0){
                            $('#Score1').text('+' + (aAnalizeResult[Lugar+1]/100).toFixed(2));
                        }else{
                            $('#Score1').text((aAnalizeResult[Lugar+1]/100).toFixed(2)); 
                        }                        
                    }
                    Lugar = BuscarLugar('mate');
                    if (Lugar != -1){
                        $('#Score1').text('mate ' + aAnalizeResult[Lugar+1]);
                    }
                    Lugar = BuscarLugar('pv');
                    if (Lugar != -1){
                        $('#Variant1').html('');
                        var cVar = '';
                        for (var x = Lugar + 1; x < aSize; x++){
                            cVar = cVar + ' ' + aAnalizeResult[x];
                            cVar = cVar.trim();                            
                            ConvertVariant(1,cVar);                                                                                                                       
                        }
                    }
                }else if(aAnalizeResult[Lugar+1]==2){
                    console.log('Variante: 2')
                    Lugar = BuscarLugar('cp');
                    if (Lugar != -1){
                        if (aAnalizeResult[Lugar+1] > 0){
                            $('#Score2').text('+' + (aAnalizeResult[Lugar+1]/100).toFixed(2));
                        }else{
                            $('#Score2').text((aAnalizeResult[Lugar+1]/100).toFixed(2));
                        }                        
                    }
                    Lugar = BuscarLugar('mate');
                    if (Lugar != -1){
                        $('#Score2').text('mate ' + aAnalizeResult[Lugar+1]);
                    }
                    Lugar = BuscarLugar('pv');
                    if (Lugar != -1){
                        $('#Variant2').html('');
                        var cVar = '';
                        for (var x = Lugar + 1; x < aSize; x++){
                            cVar = cVar + ' ' + aAnalizeResult[x];
                            cVar = cVar.trim();                            
                            ConvertVariant(2,cVar);                                                                                                                       
                        }
                    }
                }else if(aAnalizeResult[Lugar+1]==3){
                    console.log('Variante: 3')
                    Lugar = BuscarLugar('cp');
                    if (Lugar != -1){
                        if (aAnalizeResult[Lugar+1] > 0){
                            $('#Score3').text('+' + (aAnalizeResult[Lugar+1]/100).toFixed(2));
                        }else{
                            $('#Score3').text((aAnalizeResult[Lugar+1]/100).toFixed(2));
                        }
                    }
                    Lugar = BuscarLugar('mate');
                    if (Lugar != -1){
                        $('#Score3').text('mate ' + aAnalizeResult[Lugar+1]);
                    }
                    Lugar = BuscarLugar('pv');
                    if (Lugar != -1){
                        $('#Variant3').html('');
                        var cVar = '';
                        for (var x = Lugar + 1; x < aSize; x++){
                            cVar = cVar + ' ' + aAnalizeResult[x];
                            cVar = cVar.trim();                            
                            ConvertVariant(3,cVar);                                                                                                                       
                        }
                    }
                }
            }         
        };
        
		$('#cargandoconexion').hide();
        $('#cargarloader').hide();
        
        //$('#cargandoconexion').show();
		//$('#cargarloader').show();

        $('#BtnStop').hide();
        $('#ImgLoader').hide();
        $('#StopingLabel').hide();
        
        $('#BtnRun').click(function(){            
            $('#BtnRun').hide();
            $('#BtnStop').show();
            $('#ImgLoader').show();
            Analizando = true;
            var CadenaFEN = aFENs[ContPosi][0] + ' ' + aFENs[ContPosi][1] + ' ' + aFENs[ContPosi][2] + ' ' + aFENs[ContPosi][3] + ' ' + aFENs[ContPosi][4] + ' ' +aFENs[ContPosi][5];
            console.log(CadenaFEN)
            stockfish.postMessage("position fen " + CadenaFEN);
            if ($('#SetDepth').val()==''){
                $('#SetDepth').val('1'); 
            }
            stockfish.postMessage("go depth " + $('#SetDepth').val());                         
        });
        
        $('#BtnStop').click(function(){            
            $('#StopingLabel').show()
            stockfish.postMessage("stop");            
        });
        
        $('#new_Btn').button();        
        $('#open-or-join-room').button();
        $('#btn-leave-room').button();
        $('#playzone').button();
        $('#BtnSend').button();
        $('#BtnFlip').button();
        $('#BtnIni').button();
        $('#BtnPrev').button();
        $('#BtnNext').button();
        $('#BtnEnd').button();        
        $('#share-file').button();
        $('#BtnSave').button();
        $('#BtnSet').button();
        $('#BtnPGN').button();
        $('#BtnFen').button();        
        $('#BtnClearAll').button();        
        $('#BtnCutMoves').button();
        $('#BtnDelete').button();
        $('#BtnAddText').button();        
        $('#BtnLoad2').button();
        $('#BtnRun').button();
        $('#BtnStop').button();
                
        $('#btn-leave-room').hide();        
        
        $('#BtnCutMoves').click(function(){            
            var HayHermanos = CheckHayHermanos(ContPosi);
            if (HayHermanos) {
                CutMoves2(ContPosi);
            }else{
                CutMoves(NodoPadre);                
            }            
            RestorePosi(NodoPadre);
        });        
        
        $('#BtnDelete').click(function(){            
            DeleteMove();
        });
        
        $('#BtnFen').click(function(){
            $('#dialog-fen').dialog('open');                       
        });
        
        $('#BtnClearAll').click(function(){
            $('#dialog-info').dialog('open');                       
        });
        
        $('#BtnAddText').click(function(){
            $('#dialog-addtext').dialog('open');            
        });
        
        $('#BtnSet').click(function(){
            $('#dialog-set').dialog('open');            
        });
        
        var isSafari = navigator.vendor.indexOf('Apple')==0 && /\sSafari\//.test(navigator.userAgent); // true or false
        if (isSafari){
            $('#nick-id').css('width',170);
            $('#TxtMsg').css('width',280);
        }
        
        $('.new_Btn').on("click" , function () {
            $('#BtnLoad').click();
        });
        
        var fileInput = document.getElementById('BtnLoad');        
        
        fileInput.onclick = function () {
            this.value = null;
        };        
        
        fileInput.addEventListener('change', function(e){
            var file = fileInput.files[0];
            var textType = /text.*/;
            if (file.type.match(textType)) {
                var reader = new FileReader();
                reader.onload = function(e){                    
                    LoadPos(reader.result);
                }
                reader.readAsText(file);    
            } else {
                alert('File not supported!');
            }
        });
        
        $('#BtnSave').click(function(){
            SavePos();            
        });
        
        $('#playzone').click(function(){
            window.open('http://kaspichess.com/','_blank');            
        });
        
        $('#wqpromo').click(function(){
            MakeMove('1');
            $('#dialog-promo').dialog('close');
        });
            
        $('#wrpromo').click(function(){
            MakeMove('2');
            $('#dialog-promo').dialog('close');
        });
            
        $('#wnpromo').click(function(){
            MakeMove('3');
            $('#dialog-promo').dialog('close');
        });
            
        $('#wbpromo').click(function(){
            MakeMove('4');
            $('#dialog-promo').dialog('close');
        });
            
        $('#bqpromo').click(function(){
            MakeMove('5');
            $('#dialog-promo').dialog('close');
        });
            
        $('#brpromo').click(function(){
            MakeMove('6');
            $('#dialog-promo').dialog('close');
        });
            
        $('#bnpromo').click(function(){
            MakeMove('7');
            $('#dialog-promo').dialog('close');
        });
            
        $('#bbpromo').click(function(){
            MakeMove('8');
            $('#dialog-promo').dialog('close');
        });
        
        Reset();
        
        CargarRecursos();
        
        CreateSet();
        
        $('#dialog-promo').dialog({                
		autoOpen: false,
		height: 160,
		width: 380,
		modal: true,			
		show: 'blind',
		hide: 'explode'				
            }
	);        
        
        $('#dialog-info').dialog({
		autoOpen: false,
		height: 270,
		width: 390,
		modal: true,			
		show: 'blind',
		hide: 'explode',
		buttons: {
                        Ok: function() {
                            ClearAll();
                            $(this).dialog('close');						
                        },'Cancel': function() {
                            $(this).dialog('close');
                    }
		    }
	    });
        
        $('#dialog-fen').dialog({
		autoOpen: false,
		height: 290,
		width: 450,
		modal: true,
                show: 'blind',
		hide: 'explode',
		buttons: {
                        Ok: function() {                            
                            IntroFen();
                            $('#fen-id').val('');
                            $(this).dialog('close');                              
                        },'Cancel': function() {
                            $(this).dialog('close');
                    }
		}
	});
        
        $('#dialog-addtext').dialog({
		autoOpen: false,
		height: 440,
		width: 440,
		modal: true,			
		show: 'blind',
		hide: 'explode',
		buttons: {
                        Ok: function() {                            
                            AddText();                            
                            $(this).dialog('close');                              
                        },'Cancel': function() {
                            $(this).dialog('close');
                    }
		}
	});
        
        $('#dialog-set').dialog({
		autoOpen: false,
		height: 720,
		width: 840,
		modal: true,			
		show: 'blind',
		hide: 'explode',
		buttons: {
                        Ok: function() {                            
                            var aBuffer2 = new Array(64);
                            var i;
                            for (i = 0; i < aBuffer2.length; i++){
                                aBuffer2[i] = aPosSet[i];
                            } 
                            SendSET(aBuffer2);
                            $(this).dialog('close');
                        },
                        'Clear': function() {
                            ClearSet();
                        },
                        'Reset': function() {
                            ResetSet();                            
                        },
                        'Cancel': function() {
                            $(this).dialog('close');
                        }                        
		    }
	    });
        
        $('#dialog-fen').on('dialogclose',function(event,ui){
            
        });
	
	window.addEventListener('beforeunload', function(){            
	    //Mandar mensaje de closed
            connection.getSocket().emit('MiEvento',{
                    NickSender: $('#nick-id').val(),
                    CustomMessage: '',
                    Chanel: cChanel,
                    SubEvent: 'Closed'
            });
        }, false);                 
        
        /*document.getElementById('join-room').onclick = function(){                        
            
            //$('#join-room').prop('disabled', true);
			
			if ($('#nick-id').val()==''){
                $('#nick-id').val('anonymous');    
            }
            
            cChanel = $('#room-id').val();
                        
            //Mandar mensaje de join
            connection.getSocket().emit('MiEvento',{
                    NickSender: $('#nick-id').val(),
                    CustomMessage: '',
                    Chanel: cChanel,
                    SubEvent: 'Join'
            });            
            
            connection.connectionDescription = connection.openOrJoin(document.getElementById('room-id').value);
            
            //$('#BtnLoad').click();
                        
            $('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                                    'SYS: ' + '</span>' + 
                                    '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                                    'You have joined to the room ' + $('#room-id').val() + '</span><br>');
            $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);
            
            if (typeof URLSearchParams !== 'undefined') {
                var params = new URLSearchParams('roomname=Sesion1&nickname=KaspiChess');                
                console.log(params.toString())                
                params.delete('roomname');
                params.delete('nickname');                
                console.log(params.toString())              
            }else{
                console.log('Your browser ${navigator.appVersion} does not support URLSearchParams')
            }           
            
        };*/
        
        /*document.getElementById('disc-room').onclick = function(){
            if (connection.isInitiator) {                
                connection.closeEntireSession(function() {
                    //Entire session has been closed code;
                });
            } else {
                connection.leave();
            }
            $('#disc-room').hide();
            $('#join-room').show();
			//$('#join-room').prop('disabled', false);
            var cNickName = $('#nick-id').val();
            $('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                            cNickName + ': ' + '</span>' + 
                            '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                            'You have leave the room.' + '</span><br>');
            $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);
            /*connection.getSocket().emit('MiEvento',{
                    NickSender: $('#nick-id').val(),
                    CustomMessage: '',
                    Chanel: cChanel,
                    SubEvent: 'Closed'
            });*/                        
            //window.location.search = "&roomname=" + $('#room-id').val() + "&nickname=" + $('#nick-id').val();            
        //}
        
        document.getElementById('share-file').onclick = function(){
                var fileSelector = new FileSelector();
                fileSelector.selectSingleFile(function(file){
                connection.send(file);
            });
        };
        
        document.getElementById('BtnPGN').onclick = function(){
                var fileSelector = new FileSelector();
                fileSelector.selectSingleFile(function(file){
                    var textType = /.*/;
                    if (file.type.match(textType)) {
                        var reader = new FileReader();
                        reader.onload = function(e){                    
                            console.log(reader.result);
                            if (chess.load_pgn(reader.result)) {
                                CargarPGN();
                            } else {
                                alert('File not supported!');
                            }                            
                        }
                        reader.readAsText(file);    
                    } else {
                        alert('File not supported!');
                    }                    
                });
        };
        
        connection = new RTCMultiConnection();        
        
        var isSafari = navigator.vendor.indexOf('Apple')==0 && /\sSafari\//.test(navigator.userAgent); // true or false
        if (isSafari){
            connection.mediaConstraints = {
                audio: true,
                video: {
                    facingMode: 'user'
                }
            };            
        }else{ //Android
            DetectRTC.load(function() {
                connection.mediaConstraints = {
                    audio: true,
                    video: {
                        mandatory: {
                            sourceId: DetectRTC.videoInputDevices[0].deviceId // back-camera
                        },
                        optional: []
                    }
                };
            });            
        }
        
        if ($.urlParam('roomname') == null){
            document.getElementById('room-id').value = connection.token(); 
        }else{
            document.getElementById('room-id').value = $.urlParam('roomname');
        }

        if ($.urlParam('nickname') == null){
            $('#nick-id').val('anonymous');
        }else{
            $('#nick-id').val($.urlParam('nickname'));
        }
        
        connection.channel = document.getElementById('room-id').value;
        cChanel = $('#room-id').val();
        
        connection.enableFileSharing = true; // by default, it is "false".
        
        connection.session = {
            audio: true,
            video: true,
            data: true
        };        
        
        connection.sdpConstraints.mandatory = {
            OfferToReceiveAudio: true,
            OfferToReceiveVideo: true
        };
        
        var videosContainer = document.getElementById('videos-container');                
        
        connection.onstream = function(event) {            
            
            var div = document.getElementById(event.userid);
            if (div) {
                div.querySelector('video').src = URL.createObjectURL(event.stream);
                return;
            }
        
            div = document.createElement('div');
            div.id = event.userid;
            div.appendChild(event.mediaElement);
            videosContainer.appendChild(div);
            event.mediaElement.controls = false;
            
            //$('#join-room').hide();
            $('#disc-room').show();

			$('#cargandoconexion').hide();
			$('#cargarloader').hide();
            
        };    

        connection.filesContainer = document.getElementById('file-container');

        connection.onmessage = function(e){
            
            cChanel = $('#room-id').val();
            
            var oData = JSON.parse(e.data);
            
            // Mismo Canal
            if ((oData.Chanel)==cChanel){               
                // eventos
                if ((oData.Event)=='Chat'){
                    $('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                            oData.NickSender + ': ' + '</span>' + 
                            '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                            oData.CustomMessage + '</span><br>');
                    $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);
                    $('#TxtMsg').val('');
                }else if ((oData.Event)=='SendMove'){
                    if (!Analizando){
                        GetMove(oData);
                    }                        
                }else if ((oData.Event)=='SendBorrarCas') {
                    DibujarCasillas();
                    aColorCas = [];
                }else if ((oData.Event)=='MoveClickEvent') {
                    if (!Analizando)
                        MoveClickEvent(oData);
                }else if ((oData.Event)=='MoveClick2Event') {
                    if (!Analizando)
                        MoveClick2Event(oData);
                }else if ((oData.Event)=='MoveClick5Event') {
                    if (!Analizando)
                        MoveClick5Event(oData);
                }else if ((oData.Event)=='SendColorCas') {
                    aColorCas = oData.aColorCas;
                    RecolocarRect(); 
                }else if ((oData.Event)=='BtnPrevEvent') {
                    if (!Analizando)
                        BtnPrevEvent(oData); 
                }else if ((oData.Event)=='BtnNextEvent') {
                    if (!Analizando)
                        BtnNextEvent(oData); 
                }else if ((oData.Event)=='BtnIniEvent') {
                    if (!Analizando)
                        BtnIniEvent(oData); 
                }else if ((oData.Event)=='BtnEndEvent') {
                    if (!Analizando)
                        BtnEndEvent(oData); 
                }    

            } // End Mismo Canal

        }; // End onmessage
        
        connection.onopen = function() {
            document.getElementById('share-file').disabled = false;
            //document.getElementById('input-text-chat').disabled = false;              
        };        
        
        connection.onclose = function(event) {   
            //alert('onclose');            
            //event.mediaElement.parentNode.removeChild(event.mediaElement);

            var video = document.getElementById(event.streamid);
            if (video && video.parentNode) {
                video.parentNode.removeChild(video);
            }
        };
        
        connection.onleave = function (event) { 
            
            //alert('onleave');
            
            // if room moderator left
            /*if (event.userid === connection.sessionid) {
                
                connection.checkPresence(connection.sessionid, function(isRoomExists) {
                    if (isRoomExists){
                        alert('Join')
                        connection.join(connection.sessionid);                       
                    }else{
                        alert('Open')                        
                        connection.open(connection.sessionid);
                    }
                })                
                            
            }
            
            Object.keys(connection.streamEvents).forEach(function(streamid) {
                var streamEvent = connection.streamEvents[streamid];
                if (streamEvent.userid === event.userid) {
                    connection.onstreamended(streamEvent);
                }
            });*/            
            
            //event.mediaElement.parentNode.removeChild(event.mediaElement);
            
             //var streamEvent = connection.streamEvents[connection.sessionid];
            //connection.onstreamended(streamEvent);                
            
            //Object.keys(connection.streamEvents).forEach(function(streamid) {
                //var streamEvent = connection.streamEvents[streamid];
                //connection.onstreamended(streamEvent);                
            //});
            
            //connection.close();            
            
            //$('#videos-container').empty();
            
            //SavePos();
                        
        };
        
        //Cierra la ventana negra
	    connection.onstreamended = function(e) {    
	    
        //alert('onstreamended');
        
        //e.mediaElement.parentNode.removeChild(e.mediaElement);  
            
        /*var video = document.getElementById(e.streamid);
        if (video && video.parentNode) {
            video.parentNode.removeChild(video);
        }*/
            
	    };
	
	    //Asignar los eventos aqui para que funcione el socket.on(connection.socketCustomEvent, function(message) {
        connection.socketCustomEvent = 'MiEvento';
        
        connection.connectSocket(function(socket){                        
            
            // listen custom messages from server
            socket.on(connection.socketCustomEvent,function(Message){
                
                //Eventos, por el mismo canal
                if (Message.Chanel==cChanel){                    
                    
                    if (Message.SubEvent == 'Chat') {                       
                    
                        /*$('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                                            Message.NickSender + ': ' + '</span>' + 
                                            '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                                            Message.CustomMessage + '</span><br>');
                        $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);*/
                                        
                    }else if (Message.SubEvent == 'Join') {
                        
                        $('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                                            'SYS: ' + '</span>' + 
                                            '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                                            Message.NickSender + ' has connected' + '</span><br>');
                        $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);                        
                    
                    }else if (Message.SubEvent == 'Closed') {
                        
                        $('#DivTextChat').append('<span style="color:red; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">'+ 
                                            'SYS: ' + '</span>' + 
                                            '<span style="color:green; font-size:15px; font-family:Arial,Helvetica,sans-serif; font-weight:bold">' +
                                            Message.NickSender + ' has closed the connection' + '</span><br>');
                        $('#DivTextChat').animate({scrollTop: $('#DivTextChat').prop('scrollHeight')}, 500);
                        
                        //connection.close();             
                        //$('#videos-container').empty();
                        //SavePos();
                                                
                    }else if (Message.SubEvent == 'Moving') {
                        
                        /*canvas.bringToFront(getItemByName(Message.Name));
                        if (Message.ColorSide==cColorSide){                            
                            getItemByName(Message.Name).set({top:Message.Top,left: Message.Left});
                            getItemByName(Message.Name).setCoords();    
                        }else{                            
                            //with flip
                            ReverseMove(Message.Top,Message.Left,Message.Name);                        
                        }
                        canvas.renderAll();*/                        
                        
                    }else if (Message.SubEvent == 'SendMove') {
                        
                        if (!Analizando)
                            GetMove(Message);                   
                        
                    }else if (Message.SubEvent == 'BtnIniEvent') {
                        
                        if (!Analizando)
                            BtnIniEvent(Message);                
                        
                    }else if (Message.SubEvent == 'BtnEndEvent') {
                        
                        if (!Analizando)
                            BtnEndEvent(Message);                
                        
                    }else if (Message.SubEvent == 'MoveClickEvent') {
                        
                        if (!Analizando)
                            MoveClickEvent(Message);                
                        
                    }else if (Message.SubEvent == 'MoveClick2Event') {
                        
                        if (!Analizando)
                            MoveClick2Event(Message);                
                        
                    }else if (Message.SubEvent == 'MoveClick5Event') {
                        
                        if (!Analizando)
                            MoveClick5Event(Message);                
                        
                    }else if (Message.SubEvent == 'BtnPrevEvent') {
                        
                        if (!Analizando)
                            BtnPrevEvent(Message);                
                        
                    }else if (Message.SubEvent == 'BtnNextEvent') {
                        
                        if (!Analizando)
                            BtnNextEvent(Message);                
                        
                    }else if (Message.SubEvent == 'SendColorCas') {
                        aColorCas = Message.aColorCas;
                        RecolocarRect();                        
                    }else if (Message.SubEvent == 'SendBorrarCas') {
                        DibujarCasillas();
                        aColorCas = [];
                    }
                }           
            
            });            
                        
        });
            
        $('#TxtMsg').bind('keypress',function(e){	    
            if(e.keyCode==13){                 
                SendChatText();    
            }            
	});
        
        $('#BtnSend').click(function(){
            SendChatText();            
        });
        
        $('#BtnFlip').click(function(){            
            DibujarCasillas();            
            if (cColorSide=='White'){
                cColorSide = 'Black';
                FlipCoordenadas('Black');
            }else{
                cColorSide = 'White';
                FlipCoordenadas('White');
            }
            DrawPos();
            RecolocarRect();            
        });
        
        $('#BtnIni').click(function(){
            
            $('#'+BufferMoveClick).css('background-color','white'); 
            
            NodoPadre = -1;
            NodoPadre2 = -1;
            
            ContPosi = 0;
            ContPosi2 = 0;   

            var aFEN = aFENs[ContPosi];
            var CadenaFEN = aFEN[0] + ' ' + aFEN[1] + ' ' + aFEN[2] + ' ' + aFEN[3] + ' ' + aFEN[4] + ' ' +aFEN[5];
    
            console.log(CadenaFEN)
            if (Analizando) {
                $('#bestmovelabel').text('');
                $('#ImgLoader').show();
                stockfish.postMessage("stop");    
                stockfish.postMessage("position fen " + CadenaFEN);
                stockfish.postMessage("go depth " + $('#SetDepth').val());    
            }         
            
            $('#DivMoves').html('');
            ShowLine(-1);            
            
            $('#'+ContPosi).css('background-color','yellow');
            BufferMoveClick = ContPosi;
                        
            CasIniSel.visible = false;
            CasFinSel.visible = false;
            // Primer click
            if (Click1){
                Click1 = false;
            }
                        
            var i;
            for (i = 0; i < aPos.length; i++){
                aPos[i] = aPosiciones[ContPosi][i];
            }
            
            DrawPos();
            
            /*connection.getSocket().emit('MiEvento',{
                Chanel: cChanel,
                SubEvent: 'BtnIniEvent',
                Posiciones: aPosiciones,                
                Variantes: aVariantes,
                FENs: aFENs                
            });*/

            var cChanel = $('#room-id').val();    

            var oData = {Chanel: cChanel,
                        Event: 'BtnIniEvent',
                        Posiciones: aPosiciones,                
                        Variantes: aVariantes,
                        FENs: aFENs};

            var DataJSON = JSON.stringify(oData);
            connection.send(DataJSON);
                       
        });
        
        $('#BtnEnd').click(function(){            
            
            FinalLine();
            
            /*connection.getSocket().emit('MiEvento',{
                Chanel: cChanel,
                SubEvent: 'BtnEndEvent',
                Posiciones: aPosiciones,
                ContPosi: ContPosi,
                FENs: aFENs,
                Variantes: aVariantes,                
                NodoPadre: NodoPadre,
                BufferMoveClick: BufferMoveClick
            });*/ 
            
            var cChanel = $('#room-id').val();    

            var oData = {Chanel: cChanel,
                        Event: 'BtnEndEvent',
                        Posiciones: aPosiciones,
                        ContPosi: ContPosi,
                        FENs: aFENs,
                        Variantes: aVariantes,                
                        NodoPadre: NodoPadre,
                        BufferMoveClick: BufferMoveClick};

            var DataJSON = JSON.stringify(oData);
            connection.send(DataJSON);

            var aFEN = aFENs[ContPosi];
            var CadenaFEN = aFEN[0] + ' ' + aFEN[1] + ' ' + aFEN[2] + ' ' + aFEN[3] + ' ' + aFEN[4] + ' ' +aFEN[5];
    
            console.log(CadenaFEN)
            if (Analizando) {
                $('#bestmovelabel').text('');
                $('#ImgLoader').show();
                stockfish.postMessage("stop");    
                stockfish.postMessage("position fen " + CadenaFEN);
                stockfish.postMessage("go depth " + $('#SetDepth').val());    
            }          
            
        });
        
        $('#BtnNext').click(function(){
            
            /*connection.getSocket().emit('MiEvento',{
                Chanel: cChanel,
                SubEvent: 'BtnNextEvent',
                Posiciones: aPosiciones,
                ContPosi: ContPosi,
                Variantes: aVariantes, 
                FENs: aFENs,               
                NodoPadre: NodoPadre,
                BufferMoveClick: BufferMoveClick,
                SobreVariante: SobreVariante,
                VarianteDesplegada: VarianteDesplegada
            });*/

            var cChanel = $('#room-id').val();    

            var oData = {Chanel: cChanel,
                        Event: 'BtnNextEvent',
                        Posiciones: aPosiciones,
                        ContPosi: ContPosi,
                        Variantes: aVariantes, 
                        FENs: aFENs,               
                        NodoPadre: NodoPadre,
                        BufferMoveClick: BufferMoveClick,
                        SobreVariante: SobreVariante,
                        VarianteDesplegada: VarianteDesplegada};

            var DataJSON = JSON.stringify(oData);
            connection.send(DataJSON);
            
            var HayHermano = false;
            var ContHermanos = 0;
            var NodoHermano;  
            
            if (SobreVariante){
                SobreVariante = false;
                MoveClick2(ContPosi);
            }else{            
            
                for (var x = 0; x < aVariantes.length ; x++){                    
                    if (aVariantes[x][1]==ContPosi){                    
                        NodoHermano = aVariantes[x][0];                        
                        //Check si hay hermanos
                        for (var i = 0; i < aVariantes.length; i++){
                            if (NodoHermano==aVariantes[i][0]){
                                ContHermanos++;
                            }
                            if (ContHermanos>1){
                                HayHermano = true;
                                break;
                            }
                        }                    
                    }            
                }
                
                if ((HayHermano)&&(VarianteDesplegada==false)){
                    //Mostrar todos los hermanos , label red
                    $('#DivMoves').html('');
                    for (var x = 0; x < aVariantes.length; x++){
                        if (NodoHermano==aVariantes[x][0]){
                            $('#DivMoves').append('<div class="line"></div>');                             
                            if (aVariantes[x][4]==true) {                                               
                                $('#DivMoves').append('<div id="diver'+aVariantes[x][1]+'" style="float:left; border:0px solid black;"></div>');
                                $('#diver' + aVariantes[x][1]).append('<label style="float:left; color:red; margin-left:0px; margin-top:0px; font-family:Chess; font-size:23px">' + aVariantes[x][5] + '</label>');
                                $('#diver' + aVariantes[x][1]).append('<label style="float:left; color:rgb(128, 0, 0); margin-left:6px; margin-top:2px; font-family:Arial,Helvetica,sans-serif; font-size:17px" id="'+aVariantes[x][1]+'" onclick="MoveClick(id)">' + aVariantes[x][2] + '</label>');
                            }else{                                
                                $('#DivMoves').append('<div id="diver'+aVariantes[x][1]+'" style="float:left; border:0px solid black;"></div>');
                                $('#diver' + aVariantes[x][1]).append('<label style="float:left; color:red; margin-left:0px; margin-top:0px; font-family:Chess; font-size:23px">' + aVariantes[x][5] + '</label>');
                                $('#diver' + aVariantes[x][1]).append('<label style="float:left; color:red; margin-left:6px; margin-top:2px; font-family:Arial,Helvetica,sans-serif; font-size:17px" id="'+aVariantes[x][1]+'" onclick="MoveClick(id)">' + aVariantes[x][2] + '</label>');
                            }                            
                            //Mostrar hijos
                            ShowLine(aVariantes[x][1]);                            
                        }
                    }
                    VarianteDesplegada = true;
                    $('#'+ContPosi).css('background-color','yellow');
                    BufferMoveClick = ContPosi;
                }else{            
                    //Control de variantes normal
                    var Cont = 0;
                    for (var x = 0; x < aVariantes.length ; x++){
                        if (aVariantes[x][0]==ContPosi){
                            Cont++;
                        }
                    }
                    if (Cont==0){
                        
                        //Fin de variante
                    
                    }else if (Cont==1){
                        
                        //Buscar hijo
                        NodoPadre = ContPosi;
                        for (var x = 0; x < aVariantes.length ; x++){
                            if (aVariantes[x][0]==NodoPadre){
                                ContPosi = aVariantes[x][1];   
                            }
                        }
                        
                        $('#'+BufferMoveClick).css('background-color','white'); 
                        $('#'+ContPosi).css('background-color','yellow');
                        BufferMoveClick = ContPosi;                   
                        
                        var i;
                        for (i = 0; i < aPos.length; i++){
                            aPos[i] = aPosiciones[ContPosi][i];
                        }
                        
                        if (ContPosi==0){
                            CasIniSel.visible = false;
                            CasFinSel.visible = false;
                            // Primer click
                            if (Click1){
                                Click1 = false;
                            }
                        }else{
                            CasIniSel.visible = true;
                            CasFinSel.visible = true;
                        }
                        
                        DrawPos();                    
                        
                    }else if (Cont>1){
                       
                       if (SobreVariante==false){
                        
                            SobreVariante = true;
                            
                            //Buscar primer hijo
                            NodoPadre = ContPosi;
                            for (var x = 0; x < aVariantes.length ; x++){
                                if (aVariantes[x][0]==NodoPadre){
                                    ContPosi = aVariantes[x][1];
                                    break;
                                }
                            }
                             
                            $('#'+BufferMoveClick).css('background-color','white'); 
                            $('#'+ContPosi).css('background-color','yellow');
                            BufferMoveClick = ContPosi;
                        
                        }
                        
                    }
                }
            
            }            
            
            var aFEN = aFENs[ContPosi];
            var CadenaFEN = aFEN[0] + ' ' + aFEN[1] + ' ' + aFEN[2] + ' ' + aFEN[3] + ' ' + aFEN[4] + ' ' +aFEN[5];
    
            console.log(CadenaFEN)
            if (Analizando) {
                $('#bestmovelabel').text('');
                $('#ImgLoader').show();
                stockfish.postMessage("stop");    
                stockfish.postMessage("position fen " + CadenaFEN);
                stockfish.postMessage("go depth " + $('#SetDepth').val());    
            }

        });
        
        $('#BtnPrev').click(function(){            
            
            if (UltimoMovimiento == false) {
                NodoPadre2 = NodoPadre;
                ContPosi2 = ContPosi;
            }else{
                UltimoMovimiento = false;
                NodoPadre2 = BufferNodoPadre2;
                ContPosi2 = BufferContPosi2; 
            }            
            
            for (var x = 0; x < aVariantes.length; x++){                               
                if (NodoPadre2==aVariantes[x][1]){                    
                    NodoPadre = aVariantes[x][0];
                    ContPosi = aVariantes[x][1];                    
                    break;                    
                }                
            }
                        
            $('#'+BufferMoveClick).css('background-color','white');             
            
            connection.getSocket().emit('MiEvento',{
                Chanel: cChanel,
                SubEvent: 'BtnPrevEvent',
                Posiciones: aPosiciones,
                ContPosi: ContPosi,
                Variantes: aVariantes, 
                FENs: aFENs,               
                NodoPadre: NodoPadre,
                BufferMoveClick: BufferMoveClick,
                ContPosi2: ContPosi2,
                NodoPadre2: NodoPadre2
            });
            
            ShowLineBack(0);            
            
            $('#'+ContPosi).css('background-color','yellow');
            BufferMoveClick = ContPosi;

            var aFEN = aFENs[ContPosi];
            var CadenaFEN = aFEN[0] + ' ' + aFEN[1] + ' ' + aFEN[2] + ' ' + aFEN[3] + ' ' + aFEN[4] + ' ' +aFEN[5];
    
            console.log(CadenaFEN)
            if (Analizando) {
                $('#bestmovelabel').text('');
                $('#ImgLoader').show();
                stockfish.postMessage("stop");    
                stockfish.postMessage("position fen " + CadenaFEN);
                stockfish.postMessage("go depth " + $('#SetDepth').val());    
            }
                        
            if (ContPosi==0){
                CasIniSel.visible = false;
                CasFinSel.visible = false;
                // Primer click
                if (Click1){
                    Click1 = false;
                }
            }else{
                CasIniSel.visible = true;
                CasFinSel.visible = true;
            }
            
            var i;
            for (i = 0; i < aPos.length; i++){
                aPos[i] = aPosiciones[ContPosi][i];
            }
            
            DrawPos();             
                        
        });
    
    }); // End of ready function
    
    </script>

</body>
</html>
